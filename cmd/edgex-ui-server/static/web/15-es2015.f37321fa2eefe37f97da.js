(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{Hsa7:function(e,t,s){"use strict";s.r(t),s.d(t,"SystemAgentModule",function(){return L});var i=s("ofXK"),a=s("3Pt+"),n=s("tyNb"),r=s("fXoL"),c=s("nBa0"),o=s("7PPe"),b=s("EnSQ"),d=s("limL"),l=s("1ahc"),h=s("KWWs");function g(e,t){if(1&e&&(r.Kb(0,"pre"),r.vc(1),r.Jb()),2&e){const e=r.Vb();r.wb(1),r.wc(e.config)}}let u=(()=>{class e{constructor(e,t,s,i,a,n,r){this.sysService=e,this.route=t,this.cmdSvc=s,this.dataService=i,this.metadataSvc=a,this.schedulerSvc=n,this.notiSvc=r,this.service=""}ngOnInit(){this.route.queryParams.subscribe(e=>{e.svcName&&(this.service=e.svcName,this.getConfigs())})}getConfigV2(e){switch(e){case"edgex-core-data":return this.dataService.getConfig().subscribe(e=>{this.config=JSON.stringify(e,null,3)});case"edgex-core-metadata":return this.metadataSvc.getConfig().subscribe(e=>{this.config=JSON.stringify(e,null,3)});case"edgex-core-command":return this.cmdSvc.getConfig().subscribe(e=>{this.config=JSON.stringify(e,null,3)});case"edgex-support-notifications":return this.schedulerSvc.getConfig().subscribe(e=>{this.config=JSON.stringify(e,null,3)});case"edgex-support-scheduler":return this.notiSvc.getConfig().subscribe(e=>{this.config=JSON.stringify(e,null,3)})}}getConfigs(){this.sysService.getConfigBySvcName(this.service).subscribe(e=>{this.config=JSON.stringify(e[0].config,null,3)})}edit(){}}return e.\u0275fac=function(t){return new(t||e)(r.Hb(c.a),r.Hb(n.a),r.Hb(o.a),r.Hb(b.a),r.Hb(d.a),r.Hb(l.a),r.Hb(h.a))},e.\u0275cmp=r.Bb({type:e,selectors:[["app-config"]],decls:7,vars:2,consts:[[1,"card"],[1,"card-header"],[1,"fa","fa-file-text","text-danger","mr-2"],[1,"card-body"],[4,"ngIf"]],template:function(e,t){1&e&&(r.Kb(0,"div",0),r.Kb(1,"div",1),r.Kb(2,"span"),r.Ib(3,"i",2),r.vc(4),r.Jb(),r.Jb(),r.Kb(5,"div",3),r.tc(6,g,2,1,"pre",4),r.Jb(),r.Jb()),2&e&&(r.wb(4),r.xc(" ",t.service," Config Inspect"),r.wb(2),r.bc("ngIf",t.config))},directives:[i.l],styles:[".btn[disabled][_ngcontent-%COMP%]:hover{cursor:not-allowed}"]}),e})();function p(e,t){if(1&e&&(r.Kb(0,"span",33),r.vc(1),r.Jb()),2&e){const e=r.Vb();r.wb(1),r.xc("",e.metrics.raw.mem_usage," ")}}function v(e,t){if(1&e&&(r.Kb(0,"span",33),r.vc(1),r.Jb()),2&e){const e=r.Vb();r.wb(1),r.xc("",e.metrics.cpuUsedPercent,"%")}}function m(e,t){if(1&e&&(r.Kb(0,"span",33),r.vc(1),r.Jb()),2&e){const e=r.Vb();r.wb(1),r.wc(e.metrics.raw.net_io)}}let f=(()=>{class e{constructor(e,t,s){this.route=e,this.router=t,this.sysService=s,this.refreshRate=3,this.option={tooltip:{show:!0,trigger:"axis",formatter:"{c0}%"},legend:{data:[""]},dateZoom:{show:!1,start:0,end:100},calculable:!0,xAxis:[{type:"category",boundaryGap:!1,data:[0,0,0,0,0,0,0,0,0,0]}],yAxis:[{type:"value",axisLabel:{formatter:"{value}%"}}],series:[{name:"",type:"line",smooth:!0,itemStyle:{normal:{color:"#425CC7",areaStyle:{type:"default"}}},data:[0,0,0,0,0,0,0,0,0,0]}]},this.netChartOption={tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#922C48"}}},legend:{data:["RX","TX"]},xAxis:[{type:"category",boundaryGap:!1,data:[0,0,0,0,0,0,0,0,0,0]}],yAxis:[{type:"value"}],series:[{name:"RX",type:"line",smooth:!0,stack:"\u603b\u91cf",itemStyle:{normal:{color:"#922C48",areaStyle:{type:"default"}}},data:[0,0,0,0,0,0,0,0,0,0]},{name:"TX",type:"line",smooth:!0,stack:"\u603b\u91cf",itemStyle:{normal:{color:"#425CC7",areaStyle:{type:"default"}}},data:[0,0,0,0,0,0,0,0,0,0]}]}}ngOnInit(){this.route.queryParams.subscribe(e=>{e.svcName&&(this.service=e.svcName,this.memoryUsageChart=echarts.init(document.getElementById("memory-usage")),this.cpuUsageChart=echarts.init(document.getElementById("cpu-usage")),this.networkUsageChart=echarts.init(document.getElementById("network-usage")),this.option.legend.data.shift(),this.option.legend.data.push("Memory"),this.memoryUsageChart.setOption(this.option),this.option.legend.data.shift(),this.option.legend.data.push("CPU"),this.cpuUsageChart.setOption(this.option),this.networkUsageChart.setOption(this.netChartOption),this.sysService.getMetricsBySvcName(e.svcName).subscribe(e=>{this.metrics=e[0].metrics,this.feedAllCharts()}),this.timer=window.setInterval(this.metricsTimer,1e3*this.refreshRate,this))})}metricsTimer(e){e.sysService.getMetricsBySvcName(e.service).subscribe(t=>{this.metrics=t[0].metrics,e.feedAllCharts()})}feedAllCharts(){let e=this.cpuUsageChart.getOption();e.series[0].data.shift(),e.series[0].data.push(this.metrics.cpuUsedPercent),e.xAxis[0].data.shift(),e.xAxis[0].data.push(this.timestamp()),this.cpuUsageChart.setOption(e);let t=this.memoryUsageChart.getOption();t.series[0].data.shift(),t.series[0].data.push(this.metrics.raw.mem_perc.substring(0,this.metrics.raw.mem_perc.length-1)),t.xAxis[0].data.shift(),t.xAxis[0].data.push(this.timestamp()),this.memoryUsageChart.setOption(t);let s=this.networkUsageChart.getOption(),i=this.metrics.raw.net_io.split("/"),a=i[0].trim().replace("kB","").replace("MB",""),n=i[1].trim().replace("kB","").replace("MB","");s.series[0].data.shift(),s.series[0].data.push(a),s.series[1].data.shift(),s.series[1].data.push(n),s.xAxis[0].data.shift(),s.xAxis[0].data.push(this.timestamp()),this.networkUsageChart.setOption(s)}onRateSelect(){console.log(this.refreshRate),clearInterval(this.timer),this.timer=window.setInterval(this.metricsTimer,1e3*this.refreshRate,this)}timestamp(){let e=new Date;return`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`}ngOnDestroy(){clearInterval(this.timer)}}return e.\u0275fac=function(t){return new(t||e)(r.Hb(n.a),r.Hb(n.e),r.Hb(c.a))},e.\u0275cmp=r.Bb({type:e,selectors:[["app-metrics"]],decls:60,vars:5,consts:[[1,"card","mb-3"],[1,"card-header","font-weight-bold"],[1,"fa","fa-wrench"],[1,"card-body"],[1,"media"],[1,"align-self-center","mr-3"],[1,"fa","fa-server","fa-3x","color-edgex-red"],[1,"media-body"],[1,"mt-0","font-weight-bold"],[1,"badge","badge-success"],[1,"font-weight-bold","d-inline"],[1,"badge","badge-info","mr-2"],["class","text-weight",4,"ngIf"],[1,"font-weight-bold","ml-2","d-inline"],[1,"badge","badge-warning","mr-1"],[1,"badge","badge-primary","mr-1"],[1,"input-group","mb-3","mt-3",2,"width","200px"],[1,"input-group-prepend"],[1,"input-group-text"],[1,"form-control",3,"ngModel","ngModelChange"],["selected","","value","3"],["value","5"],["value","10"],["value","15"],[1,"row"],[1,"col-lg-4"],[1,"card-header"],[1,"fa","fa-area-chart"],[1,"card-body","overflow-auto"],["id","memory-usage",1,"vw-auto",2,"height","300px"],["id","cpu-usage",1,"vw-auto",2,"height","300px"],[1,"card"],["id","network-usage",1,"vw-auto",2,"height","300px"],[1,"text-weight"]],template:function(e,t){1&e&&(r.Kb(0,"div",0),r.Kb(1,"div",1),r.Ib(2,"i",2),r.vc(3," Setting "),r.Jb(),r.Kb(4,"div",3),r.Kb(5,"div",4),r.Kb(6,"div",5),r.Ib(7,"i",6),r.Jb(),r.Kb(8,"div",7),r.Kb(9,"h5",8),r.vc(10),r.Kb(11,"span",9),r.vc(12,"up"),r.Jb(),r.Jb(),r.Kb(13,"div",10),r.Kb(14,"span",11),r.vc(15,"mem_usage"),r.Jb(),r.tc(16,p,2,1,"span",12),r.Jb(),r.Kb(17,"div",13),r.Kb(18,"span",14),r.vc(19,"cpu_usage"),r.Jb(),r.tc(20,v,2,1,"span",12),r.Jb(),r.Kb(21,"div",13),r.Kb(22,"span",15),r.vc(23,"net_io"),r.Jb(),r.tc(24,m,2,1,"span",12),r.Jb(),r.Jb(),r.Jb(),r.Kb(25,"div",16),r.Kb(26,"div",17),r.Kb(27,"span",18),r.vc(28,"Refresh Rate"),r.Jb(),r.Jb(),r.Kb(29,"select",19),r.Sb("ngModelChange",function(e){return t.refreshRate=e})("ngModelChange",function(){return t.onRateSelect()}),r.Kb(30,"option",20),r.vc(31,"3s"),r.Jb(),r.Kb(32,"option",21),r.vc(33,"5s"),r.Jb(),r.Kb(34,"option",22),r.vc(35,"10s"),r.Jb(),r.Kb(36,"option",23),r.vc(37,"15s"),r.Jb(),r.Jb(),r.Jb(),r.Jb(),r.Jb(),r.Kb(38,"div",24),r.Kb(39,"div",25),r.Kb(40,"div",0),r.Kb(41,"div",26),r.Ib(42,"i",27),r.vc(43,"Memory usage"),r.Jb(),r.Kb(44,"div",28),r.Ib(45,"div",29),r.Jb(),r.Jb(),r.Jb(),r.Kb(46,"div",25),r.Kb(47,"div",0),r.Kb(48,"div",26),r.Ib(49,"i",27),r.vc(50,"CPU usage"),r.Jb(),r.Kb(51,"div",28),r.Ib(52,"div",30),r.Jb(),r.Jb(),r.Jb(),r.Kb(53,"div",25),r.Kb(54,"div",31),r.Kb(55,"div",26),r.Ib(56,"i",27),r.vc(57,"Network traffic"),r.Jb(),r.Kb(58,"div",28),r.Ib(59,"div",32),r.Jb(),r.Jb(),r.Jb(),r.Jb()),2&e&&(r.wb(10),r.xc("",t.service," "),r.wb(6),r.bc("ngIf",t.metrics),r.wb(4),r.bc("ngIf",t.metrics),r.wb(4),r.bc("ngIf",t.metrics),r.wb(5),r.bc("ngModel",t.refreshRate))},directives:[i.l,a.n,a.f,a.i,a.j,a.o],styles:[".btn[disabled][_ngcontent-%COMP%]:hover{cursor:not-allowed}"]}),e})(),w=(()=>{class e{constructor(e){this.activatedRoute=e}ngOnInit(){this.activatedRoute.url.subscribe(e=>console.log("The URL changed to: "+e))}}return e.\u0275fac=function(t){return new(t||e)(r.Hb(n.a))},e.\u0275cmp=r.Bb({type:e,selectors:[["app-system-agent"]],decls:1,vars:0,template:function(e,t){1&e&&r.Ib(0,"router-outlet")},directives:[n.j],styles:[""]}),e})();var y=s("hsl2"),J=s("9vc0");function S(e,t){1&e&&(r.Kb(0,"button",12),r.Ib(1,"span",13),r.vc(2," Loading... "),r.Jb())}function K(e,t){if(1&e){const e=r.Lb();r.Kb(0,"button",14),r.Sb("click",function(){return r.oc(e),r.Vb().refresh()}),r.Kb(1,"span"),r.Ib(2,"i",15),r.vc(3,"Refresh"),r.Jb(),r.Jb()}if(2&e){const e=r.Vb();r.bc("disabled",e.operationBtnDisabled)}}function C(e,t){1&e&&(r.Kb(0,"span",23),r.vc(1,"running"),r.Jb())}function x(e,t){1&e&&(r.Kb(0,"span",24),r.vc(1,"stopped"),r.Jb())}const I=function(){return["../metric"]},k=function(e){return{svcName:e}};function B(e,t){if(1&e&&(r.Kb(0,"a",25),r.Ib(1,"i",26),r.Jb()),2&e){const e=r.Vb().$implicit;r.bc("routerLink",r.gc(2,I))("queryParams",r.hc(3,k,e.name))}}function O(e,t){1&e&&(r.Kb(0,"a"),r.Ib(1,"i",27),r.Jb())}const H=function(){return["../config"]};function N(e,t){if(1&e&&(r.Kb(0,"a",25),r.Ib(1,"i",28),r.Jb()),2&e){const e=r.Vb().$implicit;r.bc("routerLink",r.gc(2,H))("queryParams",r.hc(3,k,e.name))}}function V(e,t){1&e&&(r.Kb(0,"a"),r.Ib(1,"i",27),r.Jb())}function M(e,t){if(1&e){const e=r.Lb();r.Kb(0,"span"),r.Kb(1,"span",29),r.Sb("click",function(){r.oc(e);const t=r.Vb().$implicit;return r.Vb().start(t.name)}),r.vc(2,"start"),r.Jb(),r.Kb(3,"span",30),r.Sb("click",function(){r.oc(e);const t=r.Vb().$implicit;return r.Vb().restart(t.name)}),r.vc(4,"restart"),r.Jb(),r.Kb(5,"span",31),r.Sb("click",function(){r.oc(e);const t=r.Vb().$implicit;return r.Vb().stop(t.name)}),r.vc(6,"stop"),r.Jb(),r.Jb()}}function D(e,t){1&e&&(r.Kb(0,"div",32),r.Kb(1,"span",33),r.vc(2,"Loading..."),r.Jb(),r.Jb(),r.Kb(3,"div",34),r.Kb(4,"span",33),r.vc(5,"Loading..."),r.Jb(),r.Jb(),r.Kb(6,"div",35),r.Kb(7,"span",33),r.vc(8,"Loading..."),r.Jb(),r.Jb())}function P(e,t){if(1&e&&(r.Kb(0,"tr"),r.Kb(1,"td"),r.vc(2),r.Jb(),r.Kb(3,"td",16),r.tc(4,C,2,0,"span",17),r.tc(5,x,2,0,"span",18),r.Jb(),r.Kb(6,"td",16),r.tc(7,B,2,5,"a",19),r.tc(8,O,2,0,"a",20),r.Jb(),r.Kb(9,"td",16),r.tc(10,N,2,5,"a",19),r.tc(11,V,2,0,"a",20),r.Jb(),r.Kb(12,"td"),r.tc(13,M,7,0,"span",21),r.tc(14,D,9,0,"ng-template",null,22,r.uc),r.Jb(),r.Jb()),2&e){const e=t.$implicit,s=r.lc(15),i=r.Vb();r.wb(2),r.wc(e.name),r.wb(1),r.bc("ngSwitch",e.alive),r.wb(1),r.bc("ngSwitchCase",!0),r.wb(2),r.bc("ngSwitch",e.alive),r.wb(1),r.bc("ngSwitchCase",!0),r.wb(2),r.bc("ngSwitch",e.alive),r.wb(1),r.bc("ngSwitchCase",!0),r.wb(3),r.bc("ngIf",!i.operationBtnDisabled)("ngIfElse",s)}}const U=[{path:"",component:w,children:[{path:"",redirectTo:"service-list",pathMatch:"full"},{path:"service-list",component:(()=>{class e{constructor(e,t,s){this.sysService=e,this.msgSvc=t,this.errorSvc=s,this.defaultServcies=["edgex-core-metadata","edgex-core-data","edgex-core-command","edgex-support-notifications","edgex-support-scheduler","edgex-app-rules-engine"],this.operationBtnDisabled=!1,this.toggleClass="",this.availServices=[]}ngOnInit(){this.allSvcHealthCheck()}allSvcHealthCheck(){this.sysService.getAllSvcHealth(this.defaultServcies.join(",")).subscribe(e=>{this.availServices=[],e.forEach((e,t)=>{let s={name:""+e.serviceName,statusCode:""+e.statusCode};s.alive=200===e.statusCode,this.availServices.push(s)}),this.availServices.sort((e,t)=>e.name>t.name?1:-1)})}refresh(){this.operationBtnDisabled=!0,this.sysService.getAllSvcHealth(this.defaultServcies.join(",")).subscribe(e=>{this.availServices=[],e.forEach((e,t)=>{let s={name:""+e.serviceName,statusCode:""+e.statusCode};s.alive=200===e.statusCode,this.availServices.push(s)}),this.operationBtnDisabled=!1,this.availServices.sort((e,t)=>e.name>t.name?1:-1),this.msgSvc.success("refresh")})}start(e){this.operationBtnDisabled=!0,this.sysService.startV2(e).subscribe(e=>{200===e[0].statusCode?(this.availServices.forEach(t=>{if("edgex-"+t.name===e[0].serviceName)return t.statusCode=String(e[0].statusCode),void(t.alive=!0)}),setTimeout(()=>{this.operationBtnDisabled=!1},2e3)):this.msgSvc.errors(e[0].message)})}restart(e){this.operationBtnDisabled=!0,this.sysService.restartV2(e).subscribe(e=>{200===e[0].statusCode?setTimeout(()=>{this.allSvcHealthCheck(),this.operationBtnDisabled=!1},2e3):this.msgSvc.errors(e[0].message)})}stop(e){this.operationBtnDisabled=!0,this.sysService.stopV2(e).subscribe(e=>{200===e[0].statusCode?setTimeout(()=>{this.allSvcHealthCheck(),this.operationBtnDisabled=!1},2e3):this.msgSvc.errors(e[0].message)})}}return e.\u0275fac=function(t){return new(t||e)(r.Hb(c.a),r.Hb(y.a),r.Hb(J.a))},e.\u0275cmp=r.Bb({type:e,selectors:[["app-service-list"]],decls:25,vars:3,consts:[[1,"card"],[1,"card-header"],[1,"fa","fa-list","text-danger","mr-2"],[1,"card-body","p-0"],[1,"bg-light","px-3","py-2"],["class","btn btn-primary","type","button","disabled","",4,"ngIf"],["class","btn btn-primary btn-sm ",3,"disabled","click",4,"ngIf"],[1,"table-responsive"],[1,"table","table-hover","text-truncate"],[1,"thead-light"],["scope","col"],[4,"ngFor","ngForOf"],["type","button","disabled","",1,"btn","btn-primary"],["role","status","aria-hidden","true",1,"spinner-grow","spinner-grow-sm"],[1,"btn","btn-primary","btn-sm",3,"disabled","click"],[1,"fa","fa-refresh","mr-1"],[3,"ngSwitch"],["class","badge badge-success",4,"ngSwitchCase"],["class","badge badge-danger",4,"ngSwitchDefault"],[3,"routerLink","queryParams",4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngIf","ngIfElse"],["LoadingTemplate",""],[1,"badge","badge-success"],[1,"badge","badge-danger"],[3,"routerLink","queryParams"],[1,"fa","fa-area-chart"],[1,"fa","fa-ban","fa-stack-lg","text-danger"],[1,"fa","fa-file-text"],["role","button",1,"badge","badge-info","mr-1",3,"click"],["role","button",1,"badge","badge-warning","mr-1",3,"click"],["role","button",1,"badge","badge-danger",3,"click"],["role","status",1,"spinner-grow","spinner-grow-sm","text-info","mr-1"],[1,"sr-only"],["role","status",1,"spinner-grow","spinner-grow-sm","text-warning","mr-1"],["role","status",1,"spinner-grow","spinner-grow-sm","text-danger"]],template:function(e,t){1&e&&(r.Kb(0,"div",0),r.Kb(1,"div",1),r.Ib(2,"i",2),r.Kb(3,"span"),r.vc(4,"System Services List"),r.Jb(),r.Jb(),r.Kb(5,"div",3),r.Kb(6,"div",4),r.tc(7,S,3,0,"button",5),r.tc(8,K,4,1,"button",6),r.Jb(),r.Kb(9,"div",7),r.Kb(10,"table",8),r.Kb(11,"thead",9),r.Kb(12,"tr"),r.Kb(13,"th",10),r.vc(14,"Name"),r.Jb(),r.Kb(15,"th",10),r.vc(16,"State"),r.Jb(),r.Kb(17,"th",10),r.vc(18,"Metric"),r.Jb(),r.Kb(19,"th",10),r.vc(20,"Config"),r.Jb(),r.Kb(21,"th",10),r.vc(22,"Operation"),r.Jb(),r.Jb(),r.Jb(),r.Kb(23,"tbody"),r.tc(24,P,16,9,"tr",11),r.Jb(),r.Jb(),r.Jb(),r.Jb(),r.Jb()),2&e&&(r.wb(7),r.bc("ngIf",t.operationBtnDisabled),r.wb(1),r.bc("ngIf",!t.operationBtnDisabled),r.wb(16),r.bc("ngForOf",t.availServices))},directives:[i.l,i.k,i.n,i.o,i.p,n.h],styles:[".btn[disabled][_ngcontent-%COMP%]:hover{cursor:not-allowed}"]}),e})()},{path:"metric",component:f},{path:"config",component:u}]}];let A=(()=>{class e{}return e.\u0275mod=r.Fb({type:e}),e.\u0275inj=r.Eb({factory:function(t){return new(t||e)},imports:[[n.i.forChild(U)],n.i]}),e})(),L=(()=>{class e{}return e.\u0275mod=r.Fb({type:e}),e.\u0275inj=r.Eb({factory:function(t){return new(t||e)},imports:[[i.b,a.b,A]]}),e})()}}]);